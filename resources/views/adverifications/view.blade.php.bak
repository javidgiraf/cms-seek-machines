@extends('layouts.default')
@section('content')
@push('styles')
<link rel="stylesheet" href="{{asset('frontend/assets/plugins/dropify/css/dropify.min.css')}}">
<link rel="stylesheet" href="{{asset('frontend/assets/plugins/summernote/dist/summernote.css')}}" />
<link href="{{asset('frontend/assets/plugins/bootstrap-select/css/bootstrap-select.css')}}" rel="stylesheet" />
<link rel="stylesheet" href="{{asset('frontend/assets/plugins/select2/select2.css')}}" />
<style>
    .remove-btn {

        border: none;
        cursor: pointer;
        width: 41px;
        height: 40px;
        /* padding: 10px; */
        /* padding-bottom: 10px; */
        margin: 5px;
    }

    .attach-file.style--three {
        width: auto;
        height: auto;
        padding: 5px 15px;

        display: inline-flex;
        background-color: #CCF5F8;
        color: #09D1DE;
    }
</style>
@endpush
<section class="content">
    <div class="body_scroll">
        <div class="block-header">
            <div class="row">
                <div class="col-lg-7 col-md-6 col-sm-12">
                    <h2>Selling Machines Ads</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{route('home')}}"><i class="zmdi zmdi-home"></i> Home</a></li>
                        <li class="breadcrumb-item"><a href="{{route('sellmachines.index')}}">Selling Machines Ads</a></li>
                        <li class="breadcrumb-item active">View Selling Machines Ads</li>
                    </ul>
                    <button class="btn btn-primary btn-icon mobile_menu" type="button"><i class="zmdi zmdi-sort-amount-desc"></i></button>
                </div>
                {{-- <div class="col-lg-5 col-md-6 col-sm-12">
                    <button class="btn btn-primary btn-icon float-right right_icon_toggle_btn" type="button"><i class="zmdi zmdi-arrow-right"></i></button>
                </div> --}}
            </div>
        </div>

        <div class="container-fluid">
            <!-- Vertical Layout -->
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    @if ($errors->any())
                    <div class="alert alert-danger">
                        <ul>
                            @foreach ($errors->all() as $error)
                            <li>{{ $error }}</li>
                            @endforeach
                        </ul>
                    </div>
                    @endif


                </div>
            </div>

            <!-- Horizontal Layout -->
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <form method="post" enctype="multipart/form-data" action="{{route('sellmachines.changestatus',$sellmachine->id) }}">
                        @csrf
                        @method('put')
                        <div class="card">
                            <div class="header">
                                <h2><strong>View</strong>Customer</h2>
                                <div style='text-align: end' ;><a href="{{route('sellmachines.index')}}" class="btn btn-primary"><i class="zmdi zmdi-arrow-left" style="padding-right: 6px;"></i><span>Back</span></a></div>
                            </div>
                            <div class="body">

                                <div class="row clearfix">
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="name">Name</label>
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-2">
                                        {{$sellmachine->title}}
                                    </div>

                                </div>
                                <!-- <div class="row clearfix">
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="slug">Slug</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        <div class="form-group">
                                            <input type="text" id="slug" name="slug" class="form-control" value="{{$sellmachine->slug}}" placeholder="Enter Sell Machine slug ">
                                        </div>
                                    </div>
                                </div> -->

                                <div class="row clearfix">
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="slug">Description</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        <div class="form-group">
                                            <textarea class="form-control" rows="10" id="description" name="description" readonly>{{$sellmachine->description}}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row clearfix">
                                    <div class="col-lg-2 col-md-2 col-sm-2 form-control-label">
                                        <label for="item_code">Item Code</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        {{$sellmachine->item_code }}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="category">Category</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                       {{$sellmachine->category->name}}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="slug">Image</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        @if((file_exists('storage/' . $sellmachine->default_image)) && $sellmachine->default_image!="")
                                           <img src="{{ asset('storage/' . $sellmachine->default_image) }}" style="max-width: 10%;">
                                        @else
                                           <img src="{{asset('frontend/assets/images/no-image.png')}}" style="max-width: 10%;">

                                        @endif
                                    </div>
                                <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="category">Country</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                       {{$sellmachine->country->name}}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="category">Brand</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                       {{$sellmachine->brand->manufacturer}}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="yearof">Year Of Manufacturing</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        {{$sellmachine->yearof }}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="modelno">Model No</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        {{$sellmachine->modelno }}
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="usage">Usage</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                      @if($sellmachine->usage=='used')
                                             Used
                                      @endif
                                      @if($sellmachine->usage=='new')
                                             New
                                      @endif
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                        <label for="location">Location</label>
                                    </div>
                                    <div class="col-lg-10 col-md-10 col-sm-8">
                                        {{$sellmachine->location }}
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="header">
                                <h2><strong>Gallery</strong> (Upload Mutliple Images)</h2>

                            </div>
                            <div class="body">
                                @foreach($sellmachineimages as $model)
                                <div class="row mb-4 " id="mrw-{{$model->id}}">

                                    <div class="col-5 col-lg-5">

                                        @if((file_exists('storage/' . $model->image_url)) && $model->image_url!="")
                                        <img src="{{ asset('storage/'. $model->image_url) }}" style="width: 20%;" alt="">
                                        @else
                                        <img src="{{asset('frontend/assets/images/no-image.png')}}" style="width: 20%;" alt="">
                                        @endif
                                    </div>

                                </div>
                                @endforeach

                                <hr class="mt-4" />
                                <h5 class="mb-3 mt-4"> Upload Technical Catalog </h5>
                                <div class="row">

                                    <div class="col-6">
                                        @if(!empty($technicalpdf->file_path))
                                        @if(isset($technicalpdf->file_path))
                                        <iframe class="up-tech-catalog" src="{{asset('storage/'.$technicalpdf->file_path)}}" width="30%"></iframe>
                                        @endif
                                        @endif
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">

                            <div class="body">
                                <table class="table form-table" id="customFields">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Value</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @forelse($specifications as $item)
                                        <tr id="srow-{{$item->id}}">
                                            <th>{{$item->spec_title}}</th>
                                            <td>{{$item->spec_value}}</td>

                                        </tr>
                                        @empty
                                        <tr>
                                            <td colspan="2">No data found</td>
                                        </tr>
                                        @endforelse

                                    </tbody>
                                </table>

                            </div>
                        </div>
                        <div class="card">
                        <div class="body">
                        <div class="row clearfix">

                                <div class="col-lg-2 col-md-2 col-sm-4 form-control-label">
                                    <label for="approve">Status</label>
                                </div>
                                <div class="col-lg-10 col-md-10 col-sm-8">
                                    <div class="form-group">
                                        <select class="form-control" name="status">
                                            <option selected disabled>--Please Select--</option>
                                            <option value='1' {{($sellmachine->status=='1')?'selected':''}}>Active</option>
                                            <option value='0' {{($sellmachine->status=='0')?'selected':''}}>Inactive</option>
                                            <option value='2' {{($sellmachine->status=='2')?'selected':''}}>Pending</option>

                                        </select>
                                    </div>
                                </div>

                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-8 offset-sm-2">
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

@push('scripts')
<script src="{{asset('frontend/assets/plugins/dropify/js/dropify.min.js')}}"></script>
<script src="{{asset('frontend/assets/js/pages/forms/dropify.js')}}"></script>
<script src="{{asset('frontend/assets/plugins/summernote/dist/summernote.js')}}"></script>
<script src="{{asset('frontend/assets/plugins/jquery-repeater/repeater.min.js')}}"></script>
<script src="{{asset('frontend/assets/plugins/jquery-repeater/custom-repeater.js')}}"></script>
<script src="{{asset('frontend/assets/plugins/select2/select2.min.js')}}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // delete row image
        jQuery(document).delegate('.remove-btn', 'click', function(e) {

            e.preventDefault();

            let mid = jQuery(this).attr('data-id');
            mid = parseInt(mid);
            var token = $("meta[name='csrf-token']").attr("content");

            $.ajax({
                url: "{{ route('sellmachine.imagedelete', '')}}" + "/" + mid,
                type: 'DELETE',
                data: {
                    "id": mid,
                    "_token": token,
                },
                success: function() {
                    jQuery('#mrw-' + mid).remove();
                }
            });
        });

    });
    /*************** ADD NEW ROW *******************/
    $(document).ready(function() {
        $(".addCF").click(function() {
            $("#customFields").append(`<tr valign="top">
                <td><input type="text" class="form-control" id="specTitle" name="spec_title[]" value="" placeholder="Title" /></td>
                <td> <input type="text" class="form-control" id="specValue" name="spec_value[]" value="" placeholder="Value" /></td>
                <td><a href="javascript:void(0);" class="remCF" title="DELETE ROW">Delete</a></td></tr>`);
        });

        $("#customFields").on('click', '.remCF', function() {
            $(this).parent().parent().remove();
        });
    });
    /***************
     * Delete Specifications
     * ***********************/

    function deleteSpec(itemid) {
        itemid = parseInt(itemid);

        if (itemid) {
            if (!confirm("Do you really want to delete?")) {
                return false;
            }

            $.ajax({
                url: "{{route('sellmachine.specdelete', '')}}" + "/" + itemid,
                type: 'DELETE',
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                },
                dataType: 'JSON',
                contentType: false,
                cache: false,
                processData: false,
                success: function(data) {
                    if (data.success) {

                        jQuery("#srow-" + itemid).remove();
                        toastr.success('Success').css("width", "500px");
                    }
                },
                error: function(data) {
                    if (data.responseJSON.errors) {
                        // loading = false;
                        // $('#loader').html('');
                        err_str = '<dl class="row"><dt class="col-sm-12"><p><b>Whoops!</b> There were some problems with your input.</p></dt>';
                        $.each(data.responseJSON.errors, function(key, val) {
                            err_str += '<dt class="col-sm-4">' + key.replace("_", " ") + ' </dt><dd class="col-sm-8">' + val + '</dd>';
                        });
                        err_str += '</dl>';
                        toastr.error(err_str).css("width", "500px");
                        return;
                    }
                }

            });

        } else {
            jQuery("#srow-" + itemid).remove();
        }

    }
</script>
@endpush
@endsection
